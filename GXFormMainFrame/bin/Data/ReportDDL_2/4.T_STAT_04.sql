IF OBJECT_ID('T_STAT_04_JS')IS NOT NULL DROP VIEW T_STAT_04_JS
GO
CREATE VIEW T_STAT_04_JS AS
	SELECT SHENG, SHI, XIAN, XIANG, CUN, LIN_YE_JU ,LIN_CHANG ,LIN_BAN ,  MIAN_JI, '0110' AS DI_LEI
	FROM T_STAT_BH where DL = '0200' and Q_DL in ('0111','0112','0113')
	
	UNION all
	SELECT SHENG, SHI, XIAN, XIANG, CUN, LIN_YE_JU ,LIN_CHANG ,LIN_BAN ,  MIAN_JI, '0120' AS DI_LEI
	FROM T_STAT_BH where DL = '0200' and Q_DL ='0120'
	
	UNION all
	SELECT SHENG, SHI, XIAN, XIANG, CUN, LIN_YE_JU ,LIN_CHANG ,LIN_BAN ,  MIAN_JI, '0130' AS DI_LEI
	FROM T_STAT_BH where DL = '0200'  and Q_DL in ('0131','0132')
	
	UNION all
	SELECT SHENG, SHI, XIAN, XIANG, CUN, LIN_YE_JU ,LIN_CHANG ,LIN_BAN ,  MIAN_JI, '0140' AS DI_LEI
	FROM T_STAT_BH where DL = '0200' and Q_DL = '0140'
	
	UNION all
	SELECT SHENG, SHI, XIAN, XIANG, CUN, LIN_YE_JU ,LIN_CHANG ,LIN_BAN ,  MIAN_JI, '0150' AS DI_LEI
	FROM T_STAT_BH where DL = '0200' and Q_DL = '0150'
	
	UNION all
	SELECT SHENG, SHI, XIAN, XIANG, CUN, LIN_YE_JU ,LIN_CHANG ,LIN_BAN ,  MIAN_JI, '0160' AS DI_LEI
	FROM T_STAT_BH where DL = '0200' and Q_DL = '0160'
	
	UNION all
	SELECT SHENG, SHI, XIAN, XIANG, CUN, LIN_YE_JU ,LIN_CHANG ,LIN_BAN , MIAN_JI,  '0170' AS DI_LEI
	FROM T_STAT_BH where DL = '0200' and Q_DL = '0170'
	
	UNION ALL SELECT SHENG, SHI, XIAN, XIANG, CUN, LIN_YE_JU ,LIN_CHANG ,LIN_BAN ,  MIAN_JI, '0180' AS DI_LEI
	FROM T_STAT_BH where DL = '0200' and Q_DL = '0180'
GO
IF OBJECT_ID('T_STAT_04_XZ')IS NOT NULL DROP VIEW T_STAT_04_XZ
GO
CREATE VIEW T_STAT_04_XZ AS 
	SELECT SHENG, SHI, XIAN, XIANG, CUN, LIN_YE_JU ,LIN_CHANG ,LIN_BAN ,  MIAN_JI, '0110' AS DI_LEI
	FROM T_STAT_BH where Q_DL = '0200'  and DL in ('0111','0112','0113')

	UNION all
	SELECT SHENG, SHI, XIAN, XIANG, CUN, LIN_YE_JU ,LIN_CHANG ,LIN_BAN ,  MIAN_JI, '0120' AS DI_LEI
	FROM T_STAT_BH where Q_DL = '0200'  and DL='0120'

	UNION all
	SELECT SHENG, SHI, XIAN, XIANG, CUN, LIN_YE_JU ,LIN_CHANG ,LIN_BAN ,  MIAN_JI, '0130' AS DI_LEI
	FROM T_STAT_BH where Q_DL = '0200'  and DL in ('0131','0132')

	UNION all
	SELECT SHENG, SHI, XIAN, XIANG, CUN, LIN_YE_JU ,LIN_CHANG ,LIN_BAN ,  MIAN_JI, '0140' AS DI_LEI
	FROM T_STAT_BH where Q_DL = '0200'  and DL = '0140'

	UNION all
	SELECT SHENG, SHI, XIAN, XIANG, CUN, LIN_YE_JU ,LIN_CHANG ,LIN_BAN ,  MIAN_JI, '0150' AS DI_LEI
	FROM T_STAT_BH where Q_DL = '0200'  and DL = '0150'

	UNION all
	SELECT SHENG, SHI, XIAN, XIANG, CUN, LIN_YE_JU ,LIN_CHANG ,LIN_BAN ,  MIAN_JI, '0160' AS DI_LEI
	FROM T_STAT_BH where Q_DL = '0200'  and DL = '0160'

	UNION all
	SELECT SHENG, SHI, XIAN, XIANG, CUN, LIN_YE_JU ,LIN_CHANG ,LIN_BAN , MIAN_JI,  '0170' AS DI_LEI
	FROM T_STAT_BH where Q_DL = '0200'  and DL = '0170'

	UNION ALL SELECT SHENG, SHI, XIAN, XIANG, CUN, LIN_YE_JU ,LIN_CHANG ,LIN_BAN ,  MIAN_JI, '0180' AS DI_LEI
	FROM T_STAT_BH where Q_DL = '0200'  and DL = '0180'
GO
IF OBJECT_ID('T_STAT_04_JZ')IS NOT NULL DROP VIEW T_STAT_04_JZ
GO
CREATE VIEW T_STAT_04_JZ AS 
	SELECT SHENG, SHI, XIAN, XIANG, CUN, LIN_YE_JU ,LIN_CHANG ,LIN_BAN , DI_LEI, -abs(MIAN_JI) as MJ
	FROM T_STAT_04_JS

	UNION ALL SELECT SHENG, SHI, XIAN, XIANG, CUN, LIN_YE_JU ,LIN_CHANG ,LIN_BAN , DI_LEI, MIAN_JI AS MJ
	FROM T_STAT_04_XZ
GO
IF OBJECT_ID('T_STAT_04_HB')IS NOT NULL DROP VIEW T_STAT_04_HB
GO
CREATE VIEW T_STAT_04_HB AS 
	SELECT SHENG, SHI, XIAN, (XIAN + XIANG) AS XIANG, CUN, LIN_YE_JU ,(LIN_YE_JU + LIN_CHANG ) AS LIN_CHANG ,LIN_BAN , DI_LEI, MIAN_JI, '2'as STAT
	FROM T_STAT_04_XZ

	UNION all
	SELECT SHENG, SHI, XIAN, (XIAN + XIANG) AS XIANG, CUN, LIN_YE_JU ,(LIN_YE_JU + LIN_CHANG ) AS LIN_CHANG ,LIN_BAN , DI_LEI, MIAN_JI, '3'as STAT
	FROM T_STAT_04_JS

	UNION ALL SELECT SHENG, SHI, XIAN, (XIAN + XIANG) AS XIANG, CUN, LIN_YE_JU ,(LIN_YE_JU + LIN_CHANG ) AS LIN_CHANG ,LIN_BAN , DI_LEI, MJ AS MIAN_JI, '4'as STAT
	FROM T_STAT_04_JZ
GO
IF OBJECT_ID('T_STAT_04_TMP')IS NOT NULL DROP VIEW T_STAT_04_TMP
GO
CREATE VIEW T_STAT_04_TMP AS 
	SELECT
		CASE GROUPING(XIAN) WHEN 1 THEN '00' ELSE XIAN END AS XIAN,
		CASE GROUPING(XIANG) WHEN 1 THEN '00' ELSE XIANG END AS XIANG,
		CASE GROUPING(DI_LEI) WHEN 1 THEN '00' ELSE DI_LEI END AS DI_LEI,	
		CASE GROUPING(STAT) WHEN 1 THEN '00' ELSE STAT END AS STAT,
		SUM(MIAN_JI) AS MIAN_JI
	  FROM T_STAT_04_HB 
	  GROUP BY XIAN,XIANG,DI_LEI,STAT WITH  CUBE;
GO
IF OBJECT_ID('T_STAT_04_DT')IS NOT NULL DROP VIEW T_STAT_04_DT
GO  
CREATE VIEW T_STAT_04_DT AS SELECT * FROM T_STAT_04_TMP  WHERE XIAN<>'00' AND STAT<>'00' 
GO
IF OBJECT_ID('T_STAT_04')IS NOT NULL DROP VIEW T_STAT_04
GO  
create view T_STAT_04 as
  select 
	case XIANG when '00' then XIAN  ELSE XIANG end  AS FLD1,
	STAT as FLD2,
	max(case DI_LEI when '00' then mian_ji  end )as FLD3,
	max(case di_lei when '0110' then mian_ji  end )as FLD4,
	max(case di_lei when '0120' then mian_ji  end )as FLD5,
	max(case di_lei when '0130' then mian_ji  end )as FLD6,
	max(case di_lei when '0140' then mian_ji  end )as FLD7,
	max(case di_lei when '0150' then mian_ji  end )as FLD8,
	max(case di_lei when '0160' then mian_ji  end) as FLD9,
	max(case di_lei when '0170' then mian_ji  end )as FLD10,
	max(case di_lei when '0180' then mian_ji  end )as FLD11
  from T_STAT_04_DT
  group by XIAN,xiang,stat