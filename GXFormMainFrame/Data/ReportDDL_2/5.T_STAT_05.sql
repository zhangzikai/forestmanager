IF OBJECT_ID('T_STAT_05_HB')IS NOT NULL DROP VIEW T_STAT_05_HB
GO  
CREATE VIEW T_STAT_05_HB AS 
	SELECT SHENG, SHI, XIAN, (XIAN + XIANG) AS XIANG, CUN, LIN_YE_JU ,(LIN_YE_JU + LIN_CHANG ) AS LIN_CHANG, LIN_BAN, MIAN_JI,
	(CASE
		WHEN DL IN ('0111','0112','0113') THEN '0110'
		WHEN DL = '0120' THEN '0120'
		WHEN DL IN ('0131','0132') THEN '0130'
		WHEN DL='0140' THEN '0140'
		WHEN DL='0150' THEN '0150'
		WHEN DL='0160' THEN '0160'
		WHEN DL='0170' THEN '0170'
		WHEN DL='0180' THEN '0180'
		WHEN DL='0190' THEN '0190'
		WHEN DL='0200' THEN '0200' END) AS DI_LEI,
	(CASE
		WHEN Q_DL IN ('0111','0112','0113') THEN '0110'
		WHEN Q_DL = '0120' THEN '0120'
		WHEN Q_DL IN ('0131','0132') THEN '0130'
		WHEN Q_DL='0140' THEN '0140'
		WHEN Q_DL='0150' THEN '0150'
		WHEN Q_DL='0160' THEN '0160'
		WHEN Q_DL='0170' THEN '0170'
		WHEN Q_DL='0180' THEN '0180'
		WHEN Q_DL='0190' THEN '0190'
		WHEN Q_DL='0200' THEN '0200' END) AS Q_DI_LEI,
	(CASE
		WHEN BHYY IN('10','11','12','13') THEN '10'
		WHEN BHYY IN('20','21','22','23','24') THEN '20'
		WHEN BHYY IN('30','31','32','33') THEN '30'
		WHEN BHYY IN('40','41','42') THEN '40'
		WHEN BHYY IN('70','71','72','73') THEN '70'
		WHEN BHYY IN('80','81','82') THEN '80'
		WHEN BHYY IN('90','91','92','93','96','99') THEN '90'
		WHEN BHYY='50' THEN '50'
	 END) AS BHYY
	FROM T_STAT_BH
GO
IF OBJECT_ID('T_STAT_05_TMP')IS NOT NULL DROP VIEW T_STAT_05_TMP
GO  
CREATE VIEW T_STAT_05_TMP AS 
	SELECT
		CASE GROUPING(XIAN) WHEN 1 THEN '00' ELSE XIAN END AS XIAN,
		CASE GROUPING(XIANG) WHEN 1 THEN '00' ELSE XIANG END AS XIANG,	
		CASE GROUPING(Q_DI_LEI) WHEN 1 THEN '00' ELSE Q_DI_LEI END AS Q_DI_LEI,	
		CASE GROUPING(DI_LEI) WHEN 1 THEN '00' ELSE DI_LEI END AS DI_LEI,	
		CASE GROUPING(BHYY) WHEN 1 THEN '00' ELSE BHYY END AS BHYY,
		SUM(MIAN_JI) AS MIAN_JI
	  FROM T_STAT_05_HB 
	  GROUP BY XIAN,XIANG,Q_DI_LEI,DI_LEI,BHYY WITH  CUBE  
GO
IF OBJECT_ID('T_STAT_05_DT')IS NOT NULL DROP VIEW T_STAT_05_DT
GO  
CREATE VIEW T_STAT_05_DT AS SELECT * FROM T_STAT_05_TMP  WHERE XIAN<>'00'
GO
IF OBJECT_ID('T_STAT_05')IS NOT NULL DROP VIEW T_STAT_05
GO 
create view T_STAT_05 as
  select 
	case XIANG when '00' then XIAN  ELSE XIANG end  AS FLD1,
	Q_DI_LEI AS FLD2,
	DI_LEI as FLD3,
	max(case BHYY when '00' then mian_ji  end )as FLD4,
	max(case BHYY when '10' then mian_ji  end )as FLD5,
	max(case BHYY when '20' then mian_ji  end )as FLD6,
	max(case BHYY when '30' then mian_ji  end )as FLD7,
	max(case BHYY when '40' then mian_ji  end )as FLD8,
	max(case BHYY when '50' then mian_ji  end )as FLD9,
	max(case BHYY when '70' then mian_ji  end )as FLD10,
	max(case BHYY when '80' then mian_ji  end )as FLD11,
	max(case BHYY when '90' then mian_ji  end )as FLD12
  from T_STAT_05_DT
  group by XIAN,XIANG,Q_DI_LEI,DI_LEI
